-- drop table REWARD_ACTIVITY;
-- drop table LOYALTY_ACTIVITY;
-- drop table WALLET_ACTIVITY;
-- drop table USERS;
-- drop table CUSTOMER_BRAND_WALLET;
-- drop table WALLET;
-- drop table BRAND_ACTIVITY_TYPES;
-- drop table BRAND_REWARD_TYPES;
-- drop table CUSTOMER_LP_TIER;
-- drop table BRAND_LP;
-- drop table LINK_RE_BRAND;
-- drop table LINK_RR_BRAND;
-- drop table LINK_LOYALTY_TIERS;
-- drop table REWARD_EARNING_RULES;
-- drop table REWARD_REDEEMING_RULES;
-- drop table CUSTOMERS;
-- drop table LOYALTY_PROGRAM_TIERS;
-- drop table LOYALTY_PROGRAMS;
-- drop table ACTIVITY_TYPES;
-- drop table REWARD_TYPES;
-- drop table BRANDS;


delete from REWARD_ACTIVITY;
delete from LOYALTY_ACTIVITY;
delete from CUSTOMER_BRAND_WALLET;
delete from WALLET_ACTIVITY;
delete from USERS;
delete from WALLET;
delete from BRAND_ACTIVITY_TYPES;
delete from BRAND_REWARD_TYPES;
delete from CUSTOMER_LP_TIER;
delete from BRAND_LP;
delete from LINK_RE_BRAND;
delete from LINK_RR_BRAND;
delete from LINK_LOYALTY_TIERS;
delete from REWARD_EARNING_RULES;
delete from REWARD_REDEEMING_RULES;
delete from CUSTOMERS;
delete from LOYALTY_PROGRAM_TIERS;
delete from LOYALTY_PROGRAMS;
delete from ACTIVITY_TYPES;
delete from REWARD_TYPES;
delete from BRANDS;


-- SELECT * FROM user_tables;

CREATE TABLE USERS (
    USER_ID varchar2(20),
    PASSWORD varchar(20),
    USER_TYPE varchar2(10),
    primary key (USER_ID, PASSWORD)
); 

CREATE TABLE CUSTOMERS (
    CID varchar(200) NOT NULL,
    NAME varchar(255) NOT NULL,
    PHONE_NUMBER int,
    ADDRESS varchar(255),
    WALLET_ID varchar2(10),
    PRIMARY KEY (CID)
); 

create table LOYALTY_PROGRAMS (
    LP_CODE varchar2(20) primary key,
    LP_NAME varchar2(20)
);


create table BRANDS (
    BID varchar2(10) primary key,
    NAME varchar2(30),
    ADDRESS varchar2(100),
    JOIN_DATE date
);

create table BRAND_LP (
    BID varchar2(10),
    LP_CODE varchar2(20),
    primary key (BID, LP_CODE),
    constraint fk_brand_lp_bid foreign key (BID) references BRANDS(BID),
    constraint fk_brand_lp_lpcode foreign key (LP_CODE) references LOYALTY_PROGRAMS(LP_CODE)
);


create table ACTIVITY_TYPES (
    ACTIVITY_CODE varchar2(10) primary key,
    ACTIVITY_NAME varchar2(20)
);

create table REWARD_TYPES (
    REWARD_CODE varchar2(10) primary key,
    REWARD_NAME varchar2(20)
);

CREATE TABLE REWARD_ACTIVITY (
    REWARD_ACTIVITY_AUTO_ID number(3) generated by default on null as identity primary key,
    CID varchar(200) NOT NULL,
    BID varchar2(200) NOT NULL,
    REWARD_CODE varchar(255) NOT NULL,
    POINTS_REDEEMED int,
    REDEEM_DATE date,
    CONSTRAINT FK_REWARD_CID FOREIGN KEY (CID) REFERENCES CUSTOMERS(CID),
    CONSTRAINT FK_REWARD_BID FOREIGN KEY (BID) REFERENCES BRANDS(BID),
    CONSTRAINT FK_REWARD_ACTIIVITY FOREIGN KEY (REWARD_CODE) REFERENCES REWARD_TYPES(REWARD_CODE)
/* FOREIGN KEY TO REWARD_CODE OF REWARD_REDEEMING_RULES TABLE MUST BE MADE*/
);

CREATE TABLE LOYALTY_ACTIVITY (
    LOYALTY_ACTIVITY_AUTO_ID number(3) generated by default on null as identity primary key,
    CID varchar(200) NOT NULL,
    BID varchar(200) NOT NULL,
    ACTIVITY_CODE varchar(255) NOT NULL,
    POINTS_GAINED int NOT NULL, 
    ACTIVITY_DATE date,
    CONTENT varchar2(500),
    CONSTRAINT FK_LOYALTY_BID FOREIGN KEY (BID) REFERENCES BRANDS(BID),
    CONSTRAINT FK_LOYALTY_CID FOREIGN KEY (CID) REFERENCES CUSTOMERS(CID),
    CONSTRAINT FK_LOYALTY_ACTIIVITY FOREIGN KEY (ACTIVITY_CODE) REFERENCES ACTIVITY_TYPES(ACTIVITY_CODE)
/* FOREIGN KEY TO ACTIVITY CATEGORIES, REWARD_EARNING_RULES TABLE MUST BE MADE*/
);
    

CREATE TABLE WALLET (
    WALLET_ID varchar2(10) primary key,
    CID varchar(200) NOT NULL,  
    POINTS_EARNED int,   
    CONSTRAINT FK_WALLET_CID FOREIGN KEY (CID) REFERENCES CUSTOMERS(CID)
    /* POINTS EARNED MUST BE CALCULATED: SUM OF POINTS GAINED  */
);


CREATE TABLE CUSTOMER_BRAND_WALLET (
    WALLET_ID varchar2(10),
    BID varchar2(200),
    CID varchar(200),  
    LP_POINTS_EARNED int,  
    primary key (WALLET_ID, BID), 
    CONSTRAINT FK_CWALLET_WALLET_ID FOREIGN KEY (WALLET_ID) REFERENCES WALLET(WALLET_ID),
    CONSTRAINT FK_CWALLET_CID FOREIGN KEY (CID) REFERENCES CUSTOMERS(CID),
    CONSTRAINT FK_CWALLET_BID FOREIGN KEY (BID) REFERENCES BRANDS(BID)
);


CREATE TABLE WALLET_ACTIVITY (
    WALLET_ACTIVITY_AUTO_ID number(3) generated by default on null as identity primary key,
    WALLET_ID varchar2(10),
    WALLET_ACTIVITY_DATE date,
    BID varchar2(200) NOT NULL,
    ACTIVITY_CODE varchar(255),
    POINTS_EARNED_FOR_ACTIVITY int,
    CONSTRAINT FK_WALLET_ACTIVITY_WALLET_ID FOREIGN KEY (WALLET_ID) REFERENCES WALLET(WALLET_ID),
    CONSTRAINT FK_WALLET_ACTIVITY_ACTIVITY_CODE FOREIGN KEY (ACTIVITY_CODE) REFERENCES ACTIVITY_TYPES(ACTIVITY_CODE),
    CONSTRAINT FK_WALLET_BID FOREIGN KEY (BID) REFERENCES BRANDS(BID)
);


create table LOYALTY_PROGRAM_TIERS (
    TIER_ID varchar2(10) primary key,
    TIER varchar(20),
    POINTS_REQUIRED number(4),
    MULTIPLIER number(2),
    RANK number(2)
);

CREATE TABLE CUSTOMER_LP_TIER (
    CID varchar(200),
    LP_CODE varchar2(200),
    TIER_STATUS varchar2(10),
    primary key (CID, LP_CODE),
    CONSTRAINT FK_CUSTOMER_LP_TIER_CID FOREIGN KEY (CID) REFERENCES CUSTOMERS(CID),
    CONSTRAINT FK_CUSTOMER_LP_TIER_BID FOREIGN KEY (LP_CODE) REFERENCES LOYALTY_PROGRAMS(LP_CODE),
    CONSTRAINT FK_CUSTOMER_LP_TIER_TIERS_ID FOREIGN KEY (TIER_STATUS) REFERENCES LOYALTY_PROGRAM_TIERS(TIER_ID)
);

create table LINK_LOYALTY_TIERS (
    LP_CODE varchar2(20),
    TIER_ID varchar2(10),
    primary key (LP_CODE, TIER_ID),
    constraint lp_hastiers_fk foreign key (LP_CODE) references LOYALTY_PROGRAMS(LP_CODE),
    constraint hastiers_tiers_fk foreign key (TIER_ID) references LOYALTY_PROGRAM_TIERS(TIER_ID)
);

create table REWARD_EARNING_RULES (
    -- AUTO
    B_RE_ID varchar2(6),
    BID varchar2(10),
    ACTIVITY_CODE varchar2(10),
    -- ACTIVITY_NAME varchar2(20),
    NO_OF_POINTS number(5),
    VERSION_NO number(3),
    primary key (B_RE_ID, VERSION_NO),
    constraint re_activity_fk foreign key (ACTIVITY_CODE) references ACTIVITY_TYPES(ACTIVITY_CODE)
);


create table LINK_RE_BRAND (
    B_RE_ID varchar2(6),
    BID varchar2(10),
    VERSION_NO number(3),
    primary key (B_RE_ID, BID, VERSION_NO),
    constraint link_rebrand_bid_fk foreign key (BID) references BRANDS(BID),
    -- constraint link_rebrand_version_fk foreign key (VERSION_NO) references REWARD_EARNING_RULES(VERSION_NO),
    constraint link_rebrand_breid_fk foreign key (B_RE_ID, VERSION_NO) references REWARD_EARNING_RULES(B_RE_ID, VERSION_NO)
);


create table REWARD_REDEEMING_RULES (
    -- AUTO
    B_RR_ID varchar2(6),
    BID varchar2(10),
    REWARD_CODE varchar2(10),
    -- REWARD_NAME varchar2(20),
    NO_OF_POINTS number(5),
    NO_OF_INSTANCES number(5),
    VERSION_NO number(3),
    primary key(B_RR_ID, VERSION_NO),
    constraint rr_reward_fk foreign key (REWARD_CODE) references REWARD_TYPES(REWARD_CODE)
);

create table LINK_RR_BRAND (
    B_RR_ID varchar2(6),
    BID varchar2(10),
    VERSION_NO number(3),
    primary key (B_RR_ID, BID, VERSION_NO),
    constraint link_rrbrand_bid_fk foreign key (BID) references BRANDS(BID),
    -- constraint link_rebrand_version_fk foreign key (VERSION_NO) references REWARD_EARNING_RULES(VERSION_NO),
    constraint link_rrbrand_breid_fk foreign key (B_RR_ID, VERSION_NO) references REWARD_REDEEMING_RULES(B_RR_ID, VERSION_NO)
);

create table BRAND_ACTIVITY_TYPES (
    BID varchar2(10),
    ACTIVITY_CODE varchar2(20),
    primary key (BID,ACTIVITY_CODE),
    constraint fk_brand_activity_types_bid foreign key (BID) references BRANDS (BID),
    constraint fk_brand_activity_types_activity_code foreign key (ACTIVITY_CODE) references ACTIVITY_TYPES (ACTIVITY_CODE)
);


create table BRAND_REWARD_TYPES (
    BID varchar2(10),
    REWARD_CODE varchar2(20),
    primary key(BID,REWARD_CODE),
    constraint fk_brand_reward_types_bid foreign key (BID) references BRANDS(BID),
    constraint fk_brand_reward_types_reward_code foreign key (REWARD_CODE) references REWARD_TYPES(REWARD_CODE)
);

alter session set NLS_DATE_FORMAT = 'YYYY-MM-DD';

insert into LOYALTY_PROGRAMS values (
    'TLP01', 'SportGoods'
);

insert into Brands values (
    'Brand01', 'BrandX', '503 Rolling Creek Dr Austin, AR', '04/01/2021'
);

insert into BRAND_LP values (
    'Brand01', 'TLP01'
);

insert into LOYALTY_PROGRAM_TIERS values (
    'B01T01', 'Bronze', 170, 2
);

insert into LOYALTY_PROGRAM_TIERS values (
    'B01T02', 'Silver', 270, 3
);

insert into LOYALTY_PROGRAM_TIERS values (
    'B01T03', 'Gold', 450, 4
);

insert into LINK_LOYALTY_TIERS values (
    'TLP01', 'B01T01'
);

insert into LINK_LOYALTY_TIERS values (
    'TLP01', 'B01T02'
);

insert into LINK_LOYALTY_TIERS values (
    'TLP01', 'B01T03'
);

select * from LOYALTY_PROGRAM_TIERS;

insert into ACTIVITY_TYPES values (
    'A01', 'Purchase'
);

insert into ACTIVITY_TYPES values (
    'A02', 'Write a review'
);

insert into ACTIVITY_TYPES values (
    'A03', 'Refer a friend'
);


insert into REWARD_TYPES values (
    'R01', 'Gift Card'
);

insert into REWARD_TYPES values (
    'R02', 'Free Product'
);

insert into REWARD_EARNING_RULES values (
    'b01a01', 'A01', 15, 1
);

insert into REWARD_EARNING_RULES values (
    'b01a02', 'A02', 10, 1
);


insert into REWARD_REDEEMING_RULES values (
    'b01r01', 'R01', 80, 40, 1
);

insert into REWARD_REDEEMING_RULES values (
    'b01r02', 'R02', 70, 25, 1
);

select * from REWARD_EARNING_RULES;

select * from REWARD_REDEEMING_RULES;

-- Brand 2

insert into LOYALTY_PROGRAMS values (
    'TLP02', 'MegaCenter'
);

insert into Brands values (
    'Brand02', 'BrandY', '939 Orange Ave Coronado, CA', '03/25/2021' 
);

insert into BRAND_LP values (
    'Brand02', 'TLP02'
);


insert into LOYALTY_PROGRAM_TIERS values (
    'B02T01', 'Special', 210, 2
);

insert into LOYALTY_PROGRAM_TIERS values (
    'B02T02', 'Premium', 500, 3
);


insert into LINK_LOYALTY_TIERS values (
    'TLP02', 'B02T01'
);

insert into LINK_LOYALTY_TIERS values (
    'TLP02', 'B02T02'
);

select * from LOYALTY_PROGRAM_TIERS;

insert into REWARD_EARNING_RULES values (
    'b02a01', 'A01', 40, 1
);

insert into REWARD_EARNING_RULES values (
    'b02a02', 'A03', 30, 1
);

insert into REWARD_REDEEMING_RULES values (
    'b02r01', 'R01', 120, 30, 1
);

insert into REWARD_REDEEMING_RULES values (
    'b02r02', 'R02', 90, 50, 1
);

select * from REWARD_EARNING_RULES;

select * from REWARD_REDEEMING_RULES;

-- Customers

insert into CUSTOMERS values (
    'C0001', 'Peter Parker', 8636368778, '20 Ingram Street, NY', 'W0001'
);

insert into REWARD_ACTIVITY values (
    null, 'C0001', 'Brand01', 'R01', 80, '7/2/2021'
);

insert into REWARD_ACTIVITY values (
    null, 'C0001', 'Brand02', 'R01', 120, '8/25/2021'
);

insert into REWARD_ACTIVITY values (
    null, 'C0001', 'Brand02', 'R02', 90, '10/20/2021'
);


insert into LOYALTY_ACTIVITY values (
    null, 'C0001', 'Brand01', 'A01', 60, '6/10/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0001', 'Brand01', 'A02', 20, '6/18/2021', 'Good product'
);


insert into LOYALTY_ACTIVITY values (
    null, 'C0001', 'Brand02', 'A01', 80, '8/9/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0001', 'Brand02', 'A01', 40, '8/15/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0001', 'Brand02', 'A03', 30, '10/3/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0001', 'Brand02', 'A03', 60, '10/18/2021', null
);


insert into CUSTOMERS values (
    'C0002', 'Steve Rogers', 8972468552, '569 Leaman Place, NY', 'W0002'
);

insert into REWARD_ACTIVITY values (
    null, 'C0002', 'Brand01', 'R02', 70, '9/1/2021'
);


insert into LOYALTY_ACTIVITY values (
    null, 'C0002', 'Brand01', 'A01', 30, '7/2/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0002', 'Brand01', 'A01', 30, '7/8/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0002', 'Brand01', 'A02', 10, '8/5/2021', 'Test review'
);


insert into WALLET values (
    null, 'C0002', 'Brand01', 70
);



insert into CUSTOMERS values (
    'C0003', 'Diana Prince', 8547963210, '1700 Broadway St, NY', 'W0003'
);

insert into REWARD_ACTIVITY values (
    null, 'C0003', 'Brand02', 'R02', 90, '8/26/2021'
);

insert into REWARD_ACTIVITY values (
    null, 'C0003', 'Brand02', 'R02', 90, '10/18/2021'
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0003', 'Brand02', 'A01', 40, '8/1/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0003', 'Brand02', 'A01', 80, '8/10/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0003', 'Brand02', 'A01', 20, '9/2/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0003', 'Brand02', 'A03', 30, '10/1/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0003', 'Brand02', 'A03', 30, '10/16/2021', null
);


-- Brand 3

insert into LOYALTY_PROGRAMS values (
    'RLP01', 'TechSups'
);

insert into Brands values (
    'Brand03', 'BrandZ', '20 Rozel Rd Princeton, NJ', '05/08/2021'
);
insert into BRAND_LP values (
    'Brand03', 'RLP01'
);
insert into REWARD_EARNING_RULES values (
    'b03a03', 'A03', 10, 1
);



insert into REWARD_REDEEMING_RULES values (
    'b03r01', 'R01', 100, 25, 1
);

insert into WALLET values (
    null, 'C0001', 'Brand01', 80
);

insert into WALLET values (
    null, 'C0001', 'Brand02', 210
);


insert into LOYALTY_ACTIVITY values (
    null, 'C0003', 'Brand03', 'A03', 40, '7/30/2021', null
);

insert into WALLET values (
    null, 'C0003', 'Brand02', 200
);

insert into WALLET values (
    null, 'C0003', 'Brand03', 40
);

insert into CUSTOMERS values (
    'C0004', 'Billy Batson', 8974562583, '5015 Broad St, Philadelphia, PA', 'W0004'
);

insert into CUSTOMERS values (
    'C0005', 'Tony Stark', 8731596464, '10880 Malibu Point, CA', 'W0005'
);

insert into REWARD_ACTIVITY values (
    null, 'C0005', 'Brand01', 'R01', 80, '10/11/2021'
);

insert into REWARD_ACTIVITY values (
    null, 'C0005', 'Brand01', 'R02', 70, '10/17/2021'
);

insert into REWARD_ACTIVITY values (
    null, 'C0005', 'Brand02', 'R01', 120, '10/11/2021'
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0005', 'Brand01', 'A01', 90, '8/10/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0005', 'Brand03', 'A03', 30, '9/16/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0005', 'Brand03', 'A03', 20, '9/30/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0005', 'Brand01', 'A02', 50, '9/30/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0005', 'Brand02', 'A01', 160, '10/10/2021', null
);

insert into LOYALTY_ACTIVITY values (
    null, 'C0005', 'Brand01', 'A02', 30, '10/15/2021', null
);

insert into WALLET values (
    null, 'C0005', 'Brand01', 170
);

insert into WALLET values (
    null, 'C0005', 'Brand02', 160
);

insert into WALLET values (
    null, 'C0005', 'Brand03', 50
);

insert into USERS values ('Brand01', 'Brand01', 'brand');

insert into USERS values ('Brand02', 'Brand02', 'brand');

insert into USERS values ('Brand03', 'Brand03', 'brand');

insert into USERS values ('C0001', 'C0001', 'customer');

insert into USERS values ('C0002', 'C0002', 'customer');

insert into USERS values ('C0003', 'C0003', 'customer');

insert into USERS values ('C0004', 'C0004', 'customer');

insert into USERS values ('C0005', 'C0005', 'customer');

insert into USERS values ('admin', 'admin', 'admin');


select * from USERS;

select USER_TYPE from USERS where USER_ID = 'Brand03' and PASSWORD = 'Brand03';

insert into BRAND_ACTIVITY_TYPES values (
    'Brand01', 'A01'
);


insert into BRAND_ACTIVITY_TYPES values (
    'Brand01', 'A02'
);


insert into BRAND_ACTIVITY_TYPES values (
    'Brand02', 'A01'
);


insert into BRAND_ACTIVITY_TYPES values (
    'Brand02', 'A03'
);


insert into BRAND_ACTIVITY_TYPES values (
    'Brand03', 'A03'
);



insert into BRAND_REWARD_TYPES values (
    'Brand01', 'R01'
);


insert into BRAND_REWARD_TYPES values (
    'Brand01', 'R02'
);



insert into BRAND_REWARD_TYPES values (
    'Brand02', 'R01'
);



insert into BRAND_REWARD_TYPES values (
    'Brand02', 'R02'
);


insert into BRAND_REWARD_TYPES values (
    'Brand03', 'R01'
);

select * from BRAND_ACTIVITY_TYPES;

select * from BRAND_REWARD_TYPES;

